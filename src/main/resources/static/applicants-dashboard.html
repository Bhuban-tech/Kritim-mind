<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Applicants Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .badge-PENDING { background-color: #ffc107; }
        .badge-ACCEPTED { background-color: #28a745; }
        .badge-REJECTED { background-color: #dc3545; }
    </style>
</head>
<body class="bg-light p-4">

<div class="container">
    <h2 class="text-center mb-4">Applicants Dashboard</h2>

    <div class="row">
        <!-- Internship Applications -->
        <div class="col-md-6">
            <h4>Internship Applications</h4>
            <div class="mb-3">
                <label for="internshipId" class="form-label">Internship ID</label>
                <input type="number" id="internshipId" class="form-control" placeholder="e.g., 1">
                <button onclick="loadInternApplications()" class="btn btn-primary mt-2">Load Intern Applicants</button>
            </div>
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead class="table-secondary">
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Status</th>
                        <th>Action</th>
                        <th>CV</th>
                    </tr>
                    </thead>
                    <tbody id="internApplicantsTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Job Applications -->
        <div class="col-md-6">
            <h4>Job Applications</h4>
            <div class="mb-3">
                <label for="jobId" class="form-label">Job ID</label>
                <input type="number" id="jobId" class="form-control" placeholder="e.g., 1">
                <button onclick="loadJobApplications()" class="btn btn-primary mt-2">Load Job Applicants</button>
            </div>
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead class="table-secondary">
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Status</th>
                        <th>Action</th>
                        <th>CV</th>
                    </tr>
                    </thead>
                    <tbody id="jobApplicantsTable"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    function statusColor(status) {
        return {
            "PENDING": "badge-PENDING",
            "ACCEPTED": "badge-ACCEPTED",
            "REJECTED": "badge-REJECTED"
        }[status] || "badge-secondary";
    }

    function createRow(app, type) {
        console.log(app); // Debug output
        return `
    <tr>
      <td>${app.applicantName}</td>
      <td>${app.applicantEmail}</td>
      <td><span class="badge ${statusColor(app.status)}">${app.status}</span></td>
      <td>
        <select class="form-select" onchange="updateStatus('${type}', ${app.applicationId ?? app.id}, this.value)">
          <option disabled selected>Change</option>
          <option value="PENDING">Pending</option>
          <option value="ACCEPTED">Accept</option>
          <option value="REJECTED">Reject</option>
        </select>
      </td>
      <td>
        <a class="btn btn-sm btn-outline-primary" href="http://localhost:8080/${type === 'intern' ? 'internapplications' : 'jobapplications'}/downloadCV/${app.applicationId ?? app.id}" target="_blank">
          Download
        </a>
      </td>
    </tr>
  `;
    }


    function loadInternApplications() {
        const id = document.getElementById("internshipId").value;
        fetch(`http://localhost:8080/internapplications/internship/${id}`)
            .then(res => res.json())
            .then(data => {
                const table = document.getElementById("internApplicantsTable");
                table.innerHTML = "";
                data.forEach(app => table.innerHTML += createRow(app, "intern"));
            });
    }

    function loadJobApplications() {
        const id = document.getElementById("jobId").value;
        fetch(`http://localhost:8080/jobapplications/job/${id}`)
            .then(res => res.json())
            .then(data => {
                const table = document.getElementById("jobApplicantsTable");
                table.innerHTML = "";
                data.forEach(app => table.innerHTML += createRow(app, "job"));
            });
    }

    function updateStatus(type, id, status) {
        fetch(`http://localhost:8080/${type === 'intern' ? 'internapplications' : 'jobapplications'}/updateStatus/${id}?status=${status}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
            }
        })
            .then(res => res.text())
            .then(msg => {
                alert(msg);
                type === 'intern' ? loadInternApplications() : loadJobApplications();
            })
            .catch(err => alert("Error updating status"));
    }

</script>

</body>
</html>
