<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Jobs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f2f5;
            padding: 40px;
        }
        .job-card {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center mb-4">Manage Jobs</h2>
    <div id="jobsContainer" class="row"></div>
</div>

<!-- Update Modal -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <form id="updateForm" enctype="multipart/form-data">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Update Job</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">

                    <input type="hidden" id="updateJobId" name="jobId">
                    <input type="hidden" id="updateUserId" name="userId">

                    <div class="mb-3">
                        <label>Service Name</label>
                        <input type="text" class="form-control" id="updateServiceName" name="serviceName" required>
                    </div>
                    <div class="mb-3">
                        <label>Service Description</label>
                        <textarea class="form-control" id="updateServiceDescription" name="serviceDescription" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label>Post</label>
                        <input type="text" class="form-control" id="updatePost" name="post" required>
                    </div>
                    <div class="mb-3">
                        <label>Salary</label>
                        <input type="number" class="form-control" id="updateSalary" name="salary" required>
                    </div>
                    <div class="mb-3">
                        <label>Change Image (optional)</label>
                        <input type="file" class="form-control" id="updateImage" name="image">
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Update Job</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const userId = 1; // replace with actual admin ID from login

    // Load all jobs
    function loadJobs() {
        fetch("http://localhost:8080/jobs/all")
            .then(res => res.json())
            .then(jobs => {
                const container = document.getElementById("jobsContainer");
                container.innerHTML = "";
                jobs.forEach(job => {
                    const card = document.createElement("div");
                    card.className = "col-md-4 job-card";
                    card.innerHTML = `
          <div class="card">
            <img src="http://localhost:8080/jobs/image/${job.jobId}" class="card-img-top" alt="Job Image">
            <div class="card-body">
              <h5 class="card-title">${job.serviceName}</h5>
              <p class="card-text">${job.serviceDescription}</p>
              <p><strong>Post:</strong> ${job.post}</p>
              <p><strong>Salary:</strong> NPR ${job.salary}</p>
              <button class="btn btn-primary btn-sm" onclick="openUpdateModal(${job.jobId})">Update</button>
              <button class="btn btn-danger btn-sm" onclick="deleteJob(${job.jobId})">Delete</button>
            </div>
          </div>
        `;
                    container.appendChild(card);
                });
            });
    }

    // Open modal and fill form
    function openUpdateModal(jobId) {
        fetch(`http://localhost:8080/jobs/all`)
            .then(res => res.json())
            .then(jobs => {
                const job = jobs.find(j => j.jobId === jobId);
                if (job) {
                    document.getElementById("updateJobId").value = job.jobId;
                    document.getElementById("updateUserId").value = userId;
                    document.getElementById("updateServiceName").value = job.serviceName;
                    document.getElementById("updateServiceDescription").value = job.serviceDescription;
                    document.getElementById("updatePost").value = job.post;
                    document.getElementById("updateSalary").value = job.salary;

                    new bootstrap.Modal(document.getElementById("updateModal")).show();
                }
            });
    }

    // Handle job update
    document.getElementById("updateForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const form = e.target;
        const jobId = document.getElementById("updateJobId").value;

        const formData = new FormData(form);
        fetch(`http://localhost:8080/jobs/update/${jobId}?userId=${userId}`, {
            method: "PUT",
            body: formData
        })
            .then(res => res.text())
            .then(msg => {
                alert(msg);
                bootstrap.Modal.getInstance(document.getElementById("updateModal")).hide();
                loadJobs();
            })
            .catch(err => alert("Error updating job"));
    });

    // Delete job
    function deleteJob(jobId) {
        if (confirm("Are you sure you want to delete this job?")) {
            fetch(`http://localhost:8080/jobs/delete/${jobId}?userId=${userId}`, {
                method: "DELETE"
            })
                .then(res => res.text())
                .then(msg => {
                    alert(msg);
                    loadJobs();
                })
                .catch(err => alert("Error deleting job"));
        }
    }

    // Initial load
    loadJobs();
</script>

</body>
</html>
